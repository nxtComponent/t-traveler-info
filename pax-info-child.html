<dom-module id="pax-info-child">
    <template>
        <style>
             :host {
                display: block;
            }

            paper-dropdown-menu {
                --paper-input-container-underline-focus: #4CB050;
                --paper-input-container-focus-color: #4CB050;
                --paper-input-container-label-focus: lightgray;
            }

            paper-input {
                --paper-input-container-underline-focus: #4CB050;
                --paper-input-container-focus-color: #4CB050;
                --paper-input-container-label-focus: lightgray;
            }

            .item[smallMobileView] #typeAndLabel {
                margin-left: -10px;
                width: 100%;
            }

            .item[smallMobileView] #emailAndLabel {
                width: 100%;
                margin-left: -10px;
            }

            .item[smallMobileView] .inputForm #paxTitle,
            #firstName,
            #lastName {
                float: left;
                margin-left: -10px;
            }

            .item[smallMobileView] #paxTitle {
                float: left;
                width: 100%;
                margin-left: -10px;
            }

            .item[smallMobileView] #firstName {
                float: left;
                /*width: 28%;*/
                /*margin-left: -10px;*/
            }

            .item[smallMobileView] #lastName {
                float: left;
                /*width: 28%;*/
                margin-left: 10px;
            }

            .item[smallMobileView] #countryCode,
            #adultContactNo {
                float: left;
                margin-left: -10px;
            }

            .item[smallMobileView] #countryCode {
                margin-left: -10px;
                width: 46%;
            }

            .item[smallMobileView] #contactNo {
                margin-left: 25px;
                width: 46%;
            }

            .item[mobileView] #typeAndLabel {
                margin-left: -10px;
                width: 100%;
            }

            .item[mobileView] #emailAndLabel {
                width: 100%;
                margin-left: -10px;
            }

            .item[mobileView] .inputForm #paxTitle,
            #firstName,
            #lastName {
                float: left;
                margin-left: -10px;
            }

            .item[mobileView] #paxTitle {
                float: left;
                width: 100%;
                margin-left: -10px;
            }

            .item[mobileView] #countryCode,
            #adultContactNo {
                float: left;
                margin-left: -10px;
            }

            .item[mobileView] #countryCode {
                margin-left: -10px;
                width: 46%;
            }

            .item[mobileView] #contactNo {
                margin-left: 25px;
                width: 46%;
            }


            .item[tabletView] #typeAndLabel {
                margin-left: -7px;
                width: 100%;
            }

            .item[tabletView] #emailAndLabel {
                width: 100%;
                margin-left: -10px;
            }

            .item[tabletView] .inputForm #paxTitle,
            #firstName,
            #lastName {
                float: left;
                margin-left: -10px;
            }

            .item[tabletView] #paxTitle {
                float: left;
                margin-left: -10px;
            }

            .item[tabletView] #countryCode,
            #contactNo {
                float: left;
                margin-left: -10px;
            }

            .item[tabletView] #countryCode {
                margin-left: -10px;
                width: 46%;
            }

            .item[tabletView] #contactNo {
                margin-left: 25px;
                width: 46%;
            }


            .inputForm #paxTitle,
            #firstName,
            #lastName {
                float: left;
            }

            #emailAndLabel,
            #countryCode,
            #contactNo {
                float: left;
            }

            #typeAndLabel {
                width: 22%;
                float: left;
                margin-top: 4%;
                margin-left: 10px;
            }

            #typeLabel,
            #typeSubLabel {
                float: left;
            }

            #typeSubLabel {
                margin-left: 5px;
                font-size: smaller;
                color: #BDBDBD;
            }

            #paxTitle {
                width: 21%;
                margin-left: 10px;
            }

            #firstName {
                width: 21%;
                margin-left: 20px;
            }

            #lastName {
                width: 21%;
                margin-left: 20px;
            }

            #inputForm2 {
                margin-top: 20px;
            }

            #email {}

            #emailAndLabel {
                margin-left: 10px;
                width: 44.5%;
            }

            #emailLabel {
                font-size: smaller;
                color: #BDBDBD;
            }

            #countryCode {
                width: 21%;
                margin-left: 20px;
            }

            #contactNo {
                width: 21%;
                margin-left: 20px;
            }
        </style>

        <iron-media-query query="(max-width: 380px)" query-matches="{{smallMobileView}}"></iron-media-query>
        <iron-media-query query="(min-width: 380px) and (max-width:767px)" query-matches="{{mobileView}}"></iron-media-query>
        <iron-media-query query="(min-width: 768px) and (max-width:1023px)" query-matches="{{tabletView}}"></iron-media-query>
        <iron-media-query query="(min-width: 1024px) and (max-width: 1200px)" query-matches="{{desktopView}}"></iron-media-query>
        <iron-media-query query="(min-width: 1200px)" query-matches="{{largeDesktopView}}"></iron-media-query>

        <div class="item" smallMobileView$="{{smallMobileView}}" desktopView$="{{desktopView}}" tabletView$="{{tabletView}}" mobileView$="{{mobileView}}"
            largeDesktopView$="{{_largeDesktopViewOther(largeDesktopView)}}" largeDesktopViewIE$="{{_largeDesktopViewIE(largeDesktopView)}}">

            <form is="iron-form" id="form" method="post" action="/form/handler">
                <!--<div class="inputForm">-->
                <div id="typeAndLabel">
                    <label id="typeLabel">{{childTitle}}{{index}}</label>
                    <div id="typeSubLabel"> {{childInfo}}</div>
                </div>
                <div hidden$="{{showChooseGuest}}" id="chooseGuestPaxInfoDiv">
                    <paper-dropdown-menu label="choose guest" id="chooseGuest">
                        <paper-listbox slot="dropdown-content">
                            <template is="dom-repeat" items="{{paxList}}">
                                <paper-item on-tap="_showPaxInfoFields">{{item.firstName}}&nbsp{{item.lastName}}</paper-item>
                            </template>
                            <paper-item>Add New</paper-item>
                        </paper-listbox>
                    </paper-dropdown-menu>
                </div>
                <div id="paxInfoDiv{{index}}" hidden="{{showPaxInfoFields}}">
                    <div hidden$="{{showTitle}}">
                        <paper-dropdown-menu label="{{titleLabel}}" id="paxTitle" required auto-validate error-message="{{titleError}}">
                            <paper-listbox slot="dropdown-content" selected="{{titleValue}}">
                                <template is="dom-repeat" items={{titleValues}}>
                                    <paper-item>{{item.key}}</paper-item>
                                </template>
                            </paper-listbox>
                        </paper-dropdown-menu>
                        <input is="iron-input" type="hidden" bind-value="[[titleValue]]">
                    </div>

                    <div>
                        <paper-input label="{{firstNameTitle}}" id="firstName" required auto-validate error-message="{{firstNameError}}"></paper-input>
                    </div>
                    <div>
                        <paper-input label="{{lastNameTitle}}" id="lastName" required auto-validate error-message="{{lastNameError}}"></paper-input>
                    </div>

                    <!--</div>-->
                    <!--<div id="inputForm2">-->
                    <div id="emailAndLabel">
                        <paper-input label="{{emailTitle}}" id="email" hidden$={{showEmailAddress}} required auto-validate error-message="{{emailError}}"></paper-input>
                        <div id="emailLabel" hidden$="{{showEmailAddress}}">{{resource.fields.email.info}}</div>
                    </div>
                    <div hidden$={{showContactNumber}}>
                        <paper-dropdown-menu label="{{countryCodeTitle}}" id="countryCode" required auto-validate error-message="{{countryCodeError}}">
                            <paper-listbox slot="dropdown-content">
                                <template is="dom-repeat" items={{countryCodeValues}}>
                                    <paper-item>{{item.key}}</paper-item>
                                </template>
                            </paper-listbox>
                        </paper-dropdown-menu>
                    </div>
                    <div>
                        <paper-input label="{{contactNumberTitle}}" id="contactNo" hidden$={{showContactNumber}} required auto-validate error-message="{{contactNumberError}}"></paper-input>
                    </div>
                </div>
            </form>
        </div>
    </template>

    <script>
        /**
         * `pax-info-child`
         * 
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class PaxInfoChild extends Polymer.Element {
            static get is() {
                return 'pax-info-child';
            }
            static get properties() {
                return {
                    showChooseGuest: {
                        type: Boolean,
                        value: false
                    },
                    showPaxInfoFields: {
                        type: Boolean,
                        value: true
                    },
                    smallMobileView: {
                        type: Boolean,
                        value: false
                    },
                    mobileView: {
                        type: Boolean,
                        value: false
                    },
                    tabletView: {
                        type: Boolean,
                        value: false
                    },
                    desktopView: {
                        type: Boolean,
                        value: false
                    },
                    largeDesktopView: {
                        type: Boolean,
                        value: false
                    },
                    titleValue: {
                        type: String,
                        value: '0'
                    },
                    resources: {
                        type: Object,
                    },
                    option: {
                        type: Object,
                        value: {
                            "requiredField": [],
                            "requiredFieldForLeadPax": []
                        }
                    },

                    paxList: {
                        type: Array,
                        value: []
                    },
                    product: {
                        type: Object,
                        value: {
                            "rooms": []
                        }
                    },
                    allowTitle: {
                        type: Boolean,
                        value: false
                    },
                    allowTitleForLeadPax: {
                        type: Boolean,
                        value: false
                    },
                    allowContactNumber: {
                        type: Boolean,
                        value: false
                    },
                    allowContactNumberForLeadPax: {
                        type: Boolean,
                        value: false
                    },
                    allowEmail: {
                        type: Boolean,
                        value: false
                    },
                    allowEmailForLeadPax: {
                        type: Boolean,
                        value: false
                    },
                    requiredField: {
                        type: Array,
                        value: [
                            "firstname",
                            "lastname"
                        ]
                    },
                    requiredFieldForLeadPax: {
                        type: Array,
                        value: [
                            "contactNumber",
                            "title",
                            "email"
                        ]
                    },
                    terms: {
                        type: String,
                        value: 'terms-ico'
                    },
                    adultTitle: {
                        type: String,
                        value: 'Adult {count}'
                    },
                    adultInfo: {
                        type: String,
                        value: '(12+ years)'
                    },
                    childTitle: {
                        type: String,
                        value: 'Child {count}'
                    },
                    childInfo: {
                        type: String,
                        value: '(upto 7 years)'
                    },
                    titleValues: {
                        type: Array,
                        value: [{
                                "key": "Mr"
                            },
                            {
                                "key": "Ms"
                            }
                        ]
                    },
                    titleSelected: {
                        type: String,
                        value: 'Mr'
                    },
                    titleLabel: {
                        type: String,
                        value: 'Title'
                    },
                    titleError: {
                        type: String,
                        value: 'Please select a title'
                    },
                    firstNameValue: {
                        type: String,
                        value: ''
                    },
                    firstNameTitle: {
                        type: String,
                        value: 'First name'
                    },
                    firstNameError: {
                        type: String,
                        value: 'Firstname is required'
                    },
                    lastNameValue: {
                        type: String,
                        value: ''
                    },
                    lastNameTitle: {
                        type: String,
                        value: 'Last name'
                    },
                    lastNameError: {
                        type: String,
                        value: 'Lastname is required'
                    },
                    emailValue: {
                        type: String,
                        value: ''
                    },
                    emailTitle: {
                        type: String,
                        value: 'Email address'
                    },
                    emailInfo: {
                        type: String,
                        value: 'We will send you email confirmation on this address'
                    },
                    emailError: {
                        type: String,
                        value: 'Please enter a valid email address'
                    },
                    countryCodeValues: {
                        type: Array,
                        value: [{
                                "key": "India +91",
                                "value": "91"
                            },
                            {
                                "key": "USA +1",
                                "value": "1"
                            }
                        ]
                    },
                    countryCodeTitle: {
                        type: String,
                        value: 'Country code'
                    },
                    countryCodeError: {
                        type: String,
                        value: 'Countrycode is required'
                    },
                    contactNumberValue: {
                        type: Number,
                        value: ''
                    },
                    contactNumberTitle: {
                        type: String,
                        value: 'Contact number'
                    },
                    contactNumberInfo: {
                        type: String,
                        value: 'In case of any notifications our agent will reach you on this number'
                    },
                    contactNumberError: {
                        type: String,
                        value: 'Contact number is required'
                    },
                    showTitle: {
                        type: Boolean,
                        value: true
                    },
                    showContactNumber: {
                        type: Boolean,
                        value: true
                    },
                    showEmailAddress: {
                        type: Boolean,
                        value: true
                    },

                }
            }
            _showAllowFields() {
                var check = this.option.allowContactNumber;
                if (check === true) {
                    this.showContactNumber = false;
                }
                var check = this.option.allowEmail;
                if (check === true) {
                    this.showEmailAddress = false;
                }
                var check = this.option.allowTitle;
                if (check === true) {
                    this.showTitle = false;
                }
            }
            _showPaxInfoFields(e) {
                var paxIndex = e.model.index;
                var paxListArray = this.paxList;
                var divPax = this.$.form.querySelector("#paxInfoDiv" + (this.index));
                var adultFirstNameData = divPax.querySelector("#firstName");
                var adultLastNameData = divPax.querySelector("#lastName");
                var adultTitleData = divPax.querySelector("#paxTitle");
                var adultEmailData = divPax.querySelector("#email");
                var adultCountryCodeData = divPax.querySelector("#countryCode");
                var adultContactNumberData = divPax.querySelector("#contactNo");

                adultFirstNameData.value = paxListArray[paxIndex].firstName;
                adultLastNameData.value = paxListArray[paxIndex].lastName;
                adultTitleData.value = paxListArray[paxIndex].title;
                adultEmailData.value = paxListArray[paxIndex].email;
                adultCountryCodeData.value = paxListArray[paxIndex].countrycode;
                adultContactNumberData.value = paxListArray[paxIndex].contact;

                this.showChooseGuest = true;
                this.showPaxInfoFields = false;
            }
            isValidPaxInfoChild() {
                var childFirstNameValidation = this.$.firstName;
                var childLastNameValiadtion = this.$.lastName;
                var childTitleValidation = this.$.paxTitle;
                var childEmailValidation = this.$.email;
                var childCountryCodeValidation = this.$.countryCode;
                var childContactNumberValidation = this.$.contactNo;
                if (childFirstNameValidation.value === undefined) {
                    childFirstNameValidation.invalid = true;
                }
                if (childLastNameValiadtion.value === undefined) {
                    childLastNameValiadtion.invalid = true;
                }
                if (childEmailValidation.value === undefined) {
                    childEmailValidation.invalid = true;
                }
                if (childContactNumberValidation.value === undefined) {
                    childContactNumberValidation.invalid = true;
                }

                if (childFirstNameValidation.invalid || childLastNameValiadtion.invalid) {
                    return true;
                }
            }
            childData() {
                var childData = {};
                var childFirstNameData = this.$.firstName;
                var childLastNameData = this.$.lastName;
                var childTitleData = this.$.paxTitle;
                var childEmailData = this.$.email;
                var childCountryCodeData = this.$.countryCode;
                var childContactNumberData = this.$.contactNo;
                childData.type = "Child";
                childData.FirstName = childFirstNameData.value;
                childData.LastName = childLastNameData.value;
                if (this.allowTitle === true) {
                    childData.Title = childTitleData.value;
                }
                if (this.allowEmail === true) {
                    childData.Email = childEmailData.value;
                }
                if (this.allowContactNumber === true) {
                    childData.CountryCode = childCountryCodeData.value;
                    childData.ContactNumber = childContactNumberData.value;
                }
                return childData;
            }
            _dynamicStyle() {
                if (this.showTitle === false) {
                    var divLen = 2 + 1;
                } else {
                    var divLen = 2;
                }
                var len = 100 / divLen - 4.6;
                if (this.smallMobileView === true || this.mobileView === true || this.tabletView === true) {
                    Polymer.dom(this.root).querySelector("#firstName").style.width = len + "%";
                    Polymer.dom(this.root).querySelector("#lastName").style.width = len + "%";
                    if (this.showTitle === true) {
                        Polymer.dom(this.root).querySelector("#firstName").style.marginLeft = "-7px";
                    } else {
                        Polymer.dom(this.root).querySelector("#firstName").style.marginLeft = "10px";
                    }
                    if (this.showTitle === false) {
                        Polymer.dom(this.root).querySelector("#paxTitle").style.width = len + "%";
                        Polymer.dom(this.root).querySelector("#paxTitle").style.marginLeft = "-5px";
                    }
                }
            }
            /**
             * Function to set view of internet explorer.       
             * */
            _largeDesktopViewIE(largeDesktopView) {
                // Internet Explorer 6-11
                var isIE = /*@cc_on!@*/ false || !!document.documentMode;
                return isIE && largeDesktopView;
            }
            /**
             * Function for desktop view for browsers other than internet explorer.
             * */
            _largeDesktopViewOther(largeDesktopView) {
                // Internet Explorer 6-11
                var isIE = /*@cc_on!@*/ false || !!document.documentMode;
                return !isIE && largeDesktopView;
            }
            _defaultOptionValue() {
                if (this.option === undefined) {
                    this.allowContactNumber;
                    this.allowContactNumberForLeadPax;
                    this.allowTitle;
                    this.allowTitleForLeadPax;
                    this.allowEmail;
                    this.allowEmailForLeadPax;
                    this.requiredField;
                    this.requiredFieldForLeadPax;
                } else {
                    if (this.option.allowTitleForLeadPax) {
                        this.allowTitleForLeadPax = this.option.allowTitleForLeadPax;
                    }
                    if (this.option.allowTitle) {
                        this.allowTitle = this.option.allowTitle;
                    }
                    if (this.option.allowContactNumber) {
                        this.allowContactNumber = this.option.allowContactNumber;
                    }
                    if (this.option.allowContactNumberForLeadPax) {
                        this.allowContactNumberForLeadPax = this.option.allowContactNumberForLeadPax;
                    }
                    if (this.option.allowEmail) {
                        this.allowEmailt = this.option.allowEmail;
                    }
                    if (this.option.allowEmailForLeadPax) {
                        this.allowEmailForLeadPax = this.option.allowEmailForLeadPax;
                    }
                    if (this.option.requiredField) {
                        this.requiredField = this.option.requiredField;
                    }
                    if (this.option.requiredFieldForLeadPax) {
                        this.requiredFieldForLeadPax = this.option.requiredFieldForLeadPax;
                    }
                }
            }
            _defaultResourcesValue() {
                if (this.resources.icons.terms) {
                    this.terms = this.resources.icons.terms;
                }
                if (this.resources.labels.adult === undefined) {
                    this.adultTitle;
                    this.adultInfo;
                } else {
                    if (this.resources.labels.adult.title) {
                        this.adultTitle = this.resources.labels.adult.title;
                    }
                    if (this.resources.labels.adult.info) {
                        this.adultInfo = this.resources.labels.adult.info;
                    }
                }
                if (this.resources.labels.child === undefined) {
                    this.childTitle;
                    this.childInfo;
                } else {
                    if (this.resources.labels.child.title) {
                        this.childTitle = this.resources.labels.child.title;
                    }
                    if (this.resources.labels.child.info) {
                        this.childInfo = this.resources.labels.child.info;
                    }
                }
                if (this.resources.fields.title === undefined) {
                    this.titleValues;
                    this.titleSelected;
                    this.titleLabel;
                    this.titleError;
                } else {
                    if (this.resources.fields.title.values) {
                        this.titleValues = this.resources.fields.title.values;
                    }
                    if (this.resources.fields.title.selected) {
                        this.titleSelected = this.resources.fields.title.selected;
                    }
                    if (this.resources.fields.title.title) {
                        this.titleLabel = this.resources.fields.title.title;
                    }
                    if (this.resources.fields.title.errors) {
                        this.titleError = this.resources.fields.title.errors;
                    }
                }
                if (this.resources.fields.firstName === undefined) {
                    this.firstNameValue;
                    this.firstNameTitle;
                    this.firstNameError;
                } else {
                    if (this.resources.fields.firstName.value) {
                        this.firstNameValue = this.resources.fields.firstName.value;
                    }
                    if (this.resources.fields.firstName.title) {
                        this.firstNameTitle = this.resources.fields.firstName.title;
                    }
                    if (this.resources.fields.firstName.errors) {
                        this.firstNameError = this.resources.fields.firstName.errors;
                    }
                }
                if (this.resources.fields.lastName === undefined) {
                    this.lastNameValue;
                    this.lastNameTitle;
                    this.lastNameError;
                } else {
                    if (this.resources.fields.lastName.value) {
                        this.lastNameValue = this.resources.fields.lastName.value;
                    }
                    if (this.resources.fields.lastName.title) {
                        this.lastNameTitle = this.resources.fields.lastName.title;
                    }
                    if (this.resources.fields.lastName.errors) {
                        this.lastNameError = this.resources.fields.lastName.errors;
                    }
                }
                if (this.resources.fields.email === undefined) {
                    this.emailValue;
                    this.emailTitle;
                    this.emailInfo;
                    this.emailError;
                } else {
                    if (this.resources.fields.email.value) {
                        this.emailValue = this.resources.fields.email.value;
                    }
                    if (this.resources.fields.email.title) {
                        this.emailTitle = this.resources.fields.email.title;
                    }
                    if (this.resources.fields.email.errors) {
                        this.emailInfo = this.resources.fields.email.errors;
                    }
                    if (this.resources.fields.email.errors) {
                        this.emailError = this.resources.fields.email.errors;
                    }
                }
                if (this.resources.fields.countryCode === undefined) {
                    this.countryCodeValues;
                    this.countryCodeTitle;
                    this.countryCodeError;
                } else {
                    if (this.resources.fields.countryCode.values) {
                        this.countryCodeValues = this.resources.fields.countryCode.values;
                    }
                    if (this.resources.fields.countryCode.title) {
                        this.countryCodeTitle = this.resources.fields.countryCode.title;
                    }
                    if (this.resources.fields.countryCode.errors) {
                        this.countryCodeError = this.resources.fields.countryCode.errors;
                    }
                }
                if (this.resources.fields.contactNumber === undefined) {
                    this.contactNumberValue;
                    this.contactNumberTitle;
                    this.contactNumberInfo;
                    this.contactNumberError;
                } else {
                    if (this.resources.fields.contactNumber.value) {
                        this.contactNumberValue = this.resources.fields.contactNumber.value;
                    }
                    if (this.resources.fields.contactNumber.title) {
                        this.contactNumberTitle = this.resources.fields.contactNumber.title;
                    }
                    if (this.resources.fields.contactNumber.errors) {
                        this.contactNumberInfo = this.resources.fields.contactNumber.errors;
                    }
                    if (this.resources.fields.contactNumber.errors) {
                        this.contactNumberError = this.resources.fields.contactNumber.errors;
                    }
                }
            }
            ready() {
                super.ready();
                this._defaultOptionValue();
                this._defaultResourcesValue();
                this._showAllowFields();
                this._dynamicStyle();
            }

        }

        window.customElements.define(PaxInfoChild.is, PaxInfoChild);
    </script>
</dom-module>